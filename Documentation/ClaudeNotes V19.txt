Tutankham ROM Editor - Status Document V19
Last Updated: January 2025
Editor Version: V0.19
================================================================================
TABLE OF CONTENTS
================================================================================

Project Overview
Current Architecture
Implemented Features
Known Issues & Limitations
Future Development Roadmap
Technical Notes

================================================================================
1. PROJECT OVERVIEW
================================================================================
The Tutankham ROM Editor is a comprehensive Python-based editor for modifying
Tutankham (1982) arcade ROM files. The editor has evolved from a monolithic
single-file design (Editor15.py) to a modular menu-driven system (Menu.py).
Key Technologies:

Python 3.x
NumPy for array operations
Tkinter for GUI
Pillow (PIL) for image handling
Colorlog for formatted logging

ROM Files Edited:

Graphics ROMs: c1.1i through c5.5i (tiles), c9.9i (treasures)
Map ROMs: c6.6i, c7.7i (logical), c8.8i (visual)
Object ROMs: m1.1h, m2.2h (game objects, config, high scores, palettes)
Code ROMs: 3j.3h, m4.4h, m5.5h, j6.6h (fonts, UI graphics)

================================================================================
2. CURRENT ARCHITECTURE
================================================================================
Menu.py - Main Application (Current)

Centralized menu system
Launches individual editor windows
Manages global ROM cache
Handles file operations (load/save)
Window management (prevents duplicates)
Cross-window state synchronization via callbacks

Editor Windows (Launched from Menu):

Map Editor - Edit 4 maps across 4 difficulties
Tile Editor - Edit all 160 game tiles (16x16 pixels)
Font Editor - Edit 43 font characters (8x8 pixels)
UI Graphics Editor - Edit copyright, timer, counters, banners
Treasure Editor - Edit 4 end-of-level treasure graphics (44x44 pixels)
High Score Editor - Edit high score table
Palette Editor - Edit 7 color palettes (16 colors each)

State Management:

Global rom_cache dictionary stores all ROM data
state_callbacks registry enables cross-window updates
Each editor window maintains its own local state
Changes written to rom_cache, then saved to disk

================================================================================
3. IMPLEMENTED FEATURES
================================================================================
File Operations (COMPLETE)
✅ Load ROMs from bundled tutankhm.zip
✅ Load ROMs from current directory
✅ Load ROMs from selected folder
✅ Save ROMs to original locations
✅ Save ROMs to selected folder (export)
✅ Automatic copyright checksum updates
Map Editor (PARTIAL - Core Done, Object Placement Incomplete)
✅ Display all 4 maps with correct palettes
✅ Switch between 4 difficulty levels
✅ Zoom controls (1x-8x)
✅ Grid overlay toggle
✅ Object overlay toggle
✅ Coordinate display (game and editor format)
✅ Map/difficulty selection with visual highlighting
✅ Time limit configuration (per map/difficulty)
✅ Spawn rate configuration (per map/difficulty)
✅ Object counters (items, teleports, spawners, respawns)
✅ Key/keyhole validation warning
✅ Tile palette with organized sections
✅ Single tile placement with logical map auto-generation
✅ Door drag-and-drop movement
✅ Visual and logical map saving
⚠️ INCOMPLETE:
Composite object placement (teleporters, spawners)
Filled treasure box placement
Keyhole placement
Player start drag-and-drop (UI exists but not wired)
Respawn point placement (partially working)
Object deletion (right-click - partially working)

Tile Editor (UI COMPLETE - Editing Incomplete)
✅ Display all 160 tiles in grid (20 per row)
✅ Palette selection for preview
✅ Tile name labels (hex IDs)
✅ Clickable tiles open editor dialog
⚠️ TODO: Pixel-level editing canvas
Font Editor (UI COMPLETE - Editing Incomplete)
✅ Display all 43 font characters in grid (15 per row)
✅ Palette selection for preview
✅ Character name labels (0-9, A-Z, symbols)
✅ Clickable characters open editor dialog
⚠️ TODO: Pixel-level editing canvas
UI Graphics Editor (COMPLETE)
✅ Display 5 UI graphics (copyright, timer, player counter, bomb counter, stage banner)
✅ Palette selection for preview
✅ Graphic selector dropdown
✅ Descriptions for each graphic
✅ Correct rotation and scaling
⚠️ TODO: Pixel-level editing
Treasure Editor (COMPLETE - View Only)
✅ Display 4 treasure graphics (map, genie lamp, chest, tut mask)
✅ Palette selection for preview
✅ Treasure selector dropdown
✅ Descriptions for each treasure
⚠️ TODO: Pixel-level editing
High Score Editor (COMPLETE)
✅ Display HIGH SCORE and 7 ranked entries
✅ Edit score (BCD format, 0-999999)
✅ Edit name (3 ASCII characters)
✅ Edit stage (0-255)
✅ Auto-sort by score on update
✅ Auto-sync HIGH SCORE with 1st place
✅ Reset to factory defaults
✅ Grid layout for easy editing
✅ Save directly to ROM cache
Palette Editor (COMPLETE)
✅ Display all 7 palettes (4 maps + 3 unknown)
✅ 15 editable colors per palette (color 15 is always black)
✅ Click any color swatch to edit
✅ RGB sliders with correct bit ranges (R:0-7, G:0-7, B:0-3)
✅ Live preview while editing
✅ Save directly to ROM cache
✅ Reset to factory defaults
✅ Triggers callbacks to update other windows
Cross-Window Updates (COMPLETE)
✅ Palette changes refresh map editor
✅ Tile changes refresh map editor
✅ Callback system for state synchronization
================================================================================
4. KNOWN ISSUES & LIMITATIONS
================================================================================
Map Editor Issues:
Missing Object Placement Logic:
The map editor UI shows composite objects in the palette but the placement
functions are not implemented in Menu.py. These functions exist in Editor15.py
but were not ported:

place_spawner()
place_teleporter_step()
place_filled_box()
place_keyhole()
Full respawn placement workflow

Incomplete Right-Click Deletion:
Right-click deletion works for some objects but not all. Need to verify:

Items (treasure boxes, keys, rings, keyholes)
Respawn points
Spawners
Teleporters

Door Movement:
Works correctly - drag and drop functions properly.
Player Start:
Visual tile (0x29) is placed but drag-and-drop not implemented in Menu.py.
Map 1 Scroll Limit:
Map 1 is artificially limited to ~50% scroll distance in the original game.
This limit is not in the object data configuration block - suspected to be
hardcoded in program ROM. Location unknown, requires disassembly of
scroll/camera code. Likely a simple comparison like:

if (map==0 && player_x > 0xC0) clamp_scroll

Check m5.5h at 0xE560 or m4.4h for scroll tables.
Teleporter Validation:
Code exists to validate teleporters on load (remove invalid entries), but
needs testing with ROM bugs.
Spawn Tile Visualization:
Tiles 0x29 (player start) and 0x17 (respawn flame) are placed in visual map
for editor visualization only. These should be converted to 0x26 (empty path)
on save. Currently this conversion is NOT implemented in save_visual_maps_to_rom().
General Issues:
No Undo/Redo:
Changes are immediate and irreversible (except by reloading).
No Pixel Editor:
Tile, font, UI graphics, and treasure editors can view but not edit pixels.
Need to implement 8x8 or 16x16 pixel editing canvas with:

Color selection from palette
Click to paint
Grid overlay
Zoom controls

Unused Code:
Menu.py has some transitional dead code from the Editor15.py refactor:

import subprocess (unused)
window.selected_composite (old system)
window.selected_spawner_dir (old system)

These should be removed for cleanliness.
Unknown Configuration Bytes:
5 bytes at offset +0x06 in each map/difficulty object block remain mysterious.
Patterns observed: F0 F8 B0 FF B0, E0 F0 B0 FF B0, etc.
Could be: enemy AI params, treasure logic, unused padding, or other config.
================================================================================
5. FUTURE DEVELOPMENT ROADMAP
================================================================================
High Priority:

Complete Map Editor Object Placement

Port place_spawner() from Editor15.py
Port place_teleporter_step() from Editor15.py
Port place_filled_box() from Editor15.py
Port place_keyhole() from Editor15.py
Implement player start drag-and-drop
Fix respawn placement workflow
Test and fix right-click deletion for all objects


Implement Spawn Tile Conversion

Modify save_visual_maps_to_rom() to convert 0x29 and 0x17 to 0x26


Implement Pixel Editors

Create reusable pixel editing widget (8x8 and 16x16)
Integrate into tile editor
Integrate into font editor
Integrate into UI graphics editor
Integrate into treasure editor



Medium Priority:

Map Validation Tool

Check for unreachable areas
Verify all keyholes have matching keys
Ensure player start is on walkable tile
Warn about isolated sections


Quality of Life Improvements

Copy/paste for map sections
Fill tool for mass tile placement
Bulk object operations (delete all items, etc.)
Recent files list
Export to PNG (maps, tiles, fonts)


Clean Up Code

Remove dead code from Menu.py
Add docstrings to all functions
Improve error handling
Add unit tests



Research Needed:

Find Map 1 Scroll Limit

Disassemble scroll/camera code in m5.5h (0xE560?)
Locate hardcoded scroll limit check
Document for future patching


Identify Unknown Bytes

Test modifications to bytes at config offset +0x06
Document effects on gameplay
Determine if enemy AI, treasure params, or unused


Map Swapping Mystery

Cannot swap maps by changing visual/logical pointers alone
Other dependencies must exist (palette? enemy AI? treasure selection?)
Find additional map-specific tables



================================================================================
6. TECHNICAL NOTES
================================================================================
Coordinate System:

Game Origin: Bottom-left (0x00, 0x0000)
Array Origin: Top-left [0, 0]
Conversion: row_array = (map_height - 1) - (XX / 0x08)
XX Range: 0x00 to 0x58 (rows, step 8)
YYYY Range: 0x0000 to 0x01F8 (columns, step 8)

Byte Order:

All 16-bit coordinates: BIG-ENDIAN (high byte first)
Example: 0x0180 stored as [01] [80], NOT [80] [01]
This was a major bug in early versions until corrected

ROM Structure:

Visual Maps: 768 bytes per map (12 rows × 64 columns)
Logical Maps: 1792 bytes per map (64 rows × 14 columns × 2 bytes)
Object Blocks: 328 bytes per map/difficulty (16 total)
Base Offset: 0x061E (not 0x0629 as early docs stated)
Block Calculation: offset = 0x061E + ((difficulty * 4) + map_index) * 0x0148

Palette Format:

ROM Encoding: BBGGGRRR (bits 7-0)
Bit Ranges: R=0-7 (3-bit), G=0-7 (3-bit), B=0-3 (2-bit)
Scaling: R/G: value * 255 / 7, B: value * 255 / 3
Color 15: Always 0x00 (black) in all palettes

Graphics Format:

Tiles: 16×16 pixels, 4bpp (16 colors), interleaved nibbles
Fonts: 8×8 pixels, 4bpp, same format
Rotation: All graphics require 90° counterclockwise rotation
Treasures: 44×44 pixels, 4bpp, same format

Map Data Rotation:

Visual and logical maps stored rotated 90° in ROM
Visual column → Logical row
Visual row + 1 → Logical column (accounting for CC border)
Logical map layout: 64 rows × 14 columns (includes borders)
Columns 0 and 13 are CC borders (always [CC, CC])

Item/Treasure System:

Visual Map: ALWAYS stores EMPTY box tiles (0x21, 0x22, 0x4A)
Object Data: Stores FILLED tile IDs (0x6F, 0x70, 0x62)
Editor Display: Shows filled overlay on top of empty box
Pickup Constraints:

Keys (0x70): Side-accessible only (box 0x22)
Treasures (0x62): Bottom-accessible only (box 0x4A)
Rings (0x6F): Top-accessible only (box 0x21)
Keyholes (0x72): No constraint (walkable)



Copyright Protection:

Copyright graphic in c9.9i (j6.6h offset 0x05C0) is checksummed
Checksum stored at 0xE25-0xE26 in 3j.3h (big-endian)
Algorithm: Emulated M6809 checksum (A/B register carry tracking)
Must recalculate and update after any graphics edits
Implemented in calculate_copyright_checksum() and update_copyright_checksum()

Banking System:

Bank select register: 0x8300 (write only)
Banked window: 0x9000-0x9FFF (4KB visible to CPU)
Write 0x00-0x08 to select which ROM appears at 0x9000
Graphics ROMs (c1-c9) accessed via banking
Program ROMs (m1-m5, 3j, j6) at fixed addresses 0xA000-0xFFFF

High Score Format:

Scores: 3-byte BCD (Binary Coded Decimal)
Names: 3 ASCII characters
Stages: Single byte (0-255)
HIGH SCORE: Always synced with 1st place score
Location: m1.1h offset 0x4A0 (HIGH SCORE), 0x4A3-0x4CC (7 entries)

Memory Map:
For full memory map details including all discovered data structures,
see Documentation/MemoryMap.txt - this contains comprehensive offset tables
for all ROMs with sizes, descriptions, and notes.
================================================================================
VERSION HISTORY (MAJOR MILESTONES)
================================================================================
V1-V4: Initial Development

Basic tile editing
Single map display

V5: First Stable Release (Editor15.py)

Tile palette with filtered tiles
Door drag-to-move
Object data loading
3 difficulty levels (later corrected to 4)
Basic overlays

V6-V9: Major Feature Additions (Editor15.py)

4 difficulty levels (corrected)
Composite object palette
Treasure system with filled boxes
Teleporter two-phase placement
Spawn/respawn visualization
Object counters
Key/keyhole validation

V10-V14: Configuration Discovery (Editor15.py)

Map configuration discovery (spawn rate, time limit bytes)
Object block offset corrected (0x061E not 0x0629)
Player start drag-and-drop
Coordinate system corrections (BIG-ENDIAN byte order)
Copyright checksum implementation
Numerous bug fixes

V15: Modular Architecture (Menu.py Created)

Transitioned from monolithic Editor15.py to Menu.py
Centralized menu system
Individual editor windows
Global ROM cache
Window management
State synchronization callbacks

V16-V18: Editor Expansion (Menu.py)

Tile editor UI (viewing only)
Font editor UI (viewing only)
UI graphics editor (5 graphics)
Treasure editor (4 treasures)
High score editor (fully functional)

V19: Current Version (Menu.py)

Palette editor (fully functional)
Cross-window state updates
Improved UI layouts
Bug fixes
Code cleanup

================================================================================
CREDITS
================================================================================
Original Game:

Tutankham © 1982 Konami
Licensed to Stern Electronics for US distribution

ROM Analysis:

MAME project for ROM definitions and memory maps
Arcade hardware documentation community

Editor Development:

Primary development: Rodimus
AI assistance: Claude (Anthropic) - main collaboration partner
Additional assistance: Grok (xAI) - copyright checksum
Additional assistance: ChatGPT (OpenAI) - code fixes
Implementation: Python, NumPy, Tkinter, Pillow, Colorlog

Special Thanks:

MAME developers
Arcade preservation community
Tutankham speedrunning and high-score community

================================================================================
END OF STATUS DOCUMENT V19

